{% extends "layouts/main.html" %}
{% set version = "v9" %}
{% set pageTitle = "Select learners from ILR" %}

{% block header %}
{% include "includes/header.html" %}
{% include "includes/training-provider-account-header.html" %}
<nav class="das-navigation">
  <div class="govuk-width-container">
    <ul class="das-navigation__list ">
      <li class="das-navigation__list-item">
        <a class="das-navigation__link" href="/training-provider/{{version}}/index">Home</a>
      </li>
      <li class="das-navigation__list-item">
        <a class="das-navigation__link das-navigation__link--current"
          href="/training-provider/{{version}}/approvals/apprentice-requests">Apprentice requests</a>
      </li>
      <li class="das-navigation__list-item">
        <a class="das-navigation__link " href="/training-provider/{{version}}/reserve-reservations-pro">Manage
          funding</a>
      </li>
      <li class="das-navigation__list-item">
        <a class="das-navigation__link" href="/training-provider/{{version}}/manage/index">Manage your apprentices</a>
      </li>
      <li class="das-navigation__list-item">
        <a class="das-navigation__link" href="/training-provider/{{version}}/#">Recruit apprentices</a>
      </li>
      <li class="das-navigation__priority-list-item" id="priority-list-menu"><a class="das-navigation__priority-button"
          href="/training-provider/{{version}}/#">More</a>
        <ul class="das-navigation__priority-list govuk-visually-hidden">
          <li class="das-navigation__list-item">
            <a class="das-navigation__link" href="/training-provider/{{version}}/#">Organisations and agreements</a>
          </li>
        </ul>
      </li>
    </ul>
  </div>
</nav>
{% endblock %}

{% block beforeContent %}

{{ govukBackLink({
text: "Back",
href: "javascript:window.history.go(-1);"
}) }}

{% endblock %}

{% block content %}

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Select learner from ILR</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/govuk-frontend/4.7.0/govuk/all.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/accessible-autocomplete@2.0.4/dist/accessible-autocomplete.min.js"></script>
  <style>
    .autocomplete__wrapper {
      position: relative;
      max-width: 35em;
      margin-bottom: 20px;
      font-family: "GDS Transport", Arial, sans-serif;
    }

    @media (min-width: 40.0625em) {
      .autocomplete__wrapper {
        margin-bottom: 30px;
      }
    }

    .autocomplete__hint,
    .autocomplete__input {
      -webkit-appearance: none;
      border: 2px solid #0b0c0c;
      border-radius: 0;
      box-sizing: border-box;
      -moz-box-sizing: border-box;
      -webkit-box-sizing: border-box;
      margin-bottom: 0;
      width: 100%;
    }

    .autocomplete__input {
      background-color: transparent;
      position: relative;
    }

    .autocomplete__hint {
      color: #b1b4b6;
      position: absolute;
    }

    .autocomplete__input--default {
      padding: 5px;
    }

    .autocomplete__input--focused {
      outline: 3px solid #fd0;
      outline-offset: 0;
      box-shadow: inset 0 0 0 2px;
    }

    .autocomplete__input--show-all-values {
      padding: 5px 34px 5px 5px;
      cursor: pointer;
    }

    .autocomplete__dropdown-arrow-down {
      z-index: -1;
      display: inline-block;
      position: absolute;
      right: 8px;
      width: 24px;
      height: 24px;
      top: 10px;
    }

    .autocomplete__menu {
      background-color: #fff;
      border: 2px solid #0b0c0c;
      border-top: 0;
      color: #0b0c0c;
      margin: 0;
      max-height: 342px;
      overflow-x: hidden;
      padding: 0;
      width: 100%;
      width: calc(100% - 4px);
    }

    .autocomplete__menu--visible {
      display: block;
    }

    .autocomplete__menu--hidden {
      display: none;
    }

    .autocomplete__menu--overlay {
      box-shadow: rgba(0, 0, 0, 0.256863) 0 2px 6px;
      left: 0;
      position: absolute;
      top: 100%;
      z-index: 100;
    }

    .autocomplete__menu--inline {
      position: relative;
    }

    .autocomplete__option {
      border-bottom: solid #b1b4b6;
      border-width: 1px 0;
      cursor: pointer;
      display: block;
      position: relative;
    }

    .autocomplete__option>* {
      pointer-events: none;
    }

    .autocomplete__option:first-of-type {
      border-top-width: 0;
    }

    .autocomplete__option:last-of-type {
      border-bottom-width: 0;
    }

    .autocomplete__option--odd {
      background-color: #fafafa;
    }

    .autocomplete__option--focused,
    .autocomplete__option:hover {
      background-color: #1d70b8;
      border-color: #1d70b8;
      color: #fff;
      outline: 0;
    }

    .autocomplete__option--no-results {
      background-color: #fafafa;
      color: #646b6f;
      cursor: not-allowed;
    }

    .autocomplete__hint,
    .autocomplete__input,
    .autocomplete__option {
      font-size: 16px;
      line-height: 1.25;
    }

    .autocomplete__hint,
    .autocomplete__option {
      padding: 5px;
    }

    @media (min-width: 641px) {

      .autocomplete__hint,
      .autocomplete__input,
      .autocomplete__option {
        font-size: 19px;
        line-height: 1.31579;
      }
    }
  </style>
</head>

<body>
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <h1 class="govuk-heading-l">Select learners from ILR</h1>

      <details class="govuk-details">
        <summary class="govuk-details__summary">
          <span class="govuk-details__summary-text">
            What this list includes
          </span>
        </summary>
        <div class="govuk-details__text">
          <p class="govuk-body">This list shows learners from your ILR submissions who are not yet approved in this
            service.</p>

          <p class="govuk-body">It includes learners linked toÂ BAMBINOS DAY NURSERY in your ILR or not linked to any
            employer (because no Agreement ID
            has been added in the ILR).</p>
        </div>
      </details>

    </div>
  </div>


  <div class="govuk-!-padding-bottom-1"></div>

  <div class="govuk-grid-row" id="addedLearnersSection">
    <div class="govuk-grid-column-full">
      <h2 class="govuk-heading-m">Learners in cohort (<span id="addedLearnersCount">0</span>)</h2>
      <span id="some-id-hint" class="govuk-hint">
        Select all the learners you need from the list to add them to a cohort.
      </span>
      <div class="govuk-!-padding-bottom-5"></div>

      <a href="javascript:void(0)" id="removeAllLearnersLink" class="govuk-link govuk-body govuk-!-margin-right-5"
        style="display: none;">
        Remove all learners
      </a>

      <form action="/training-provider/v9/approvals/review-apprentices-1" method="post" id="addedLearnersForm">

        <div id="addedTableContainer" class="govuk-!-padding-bottom-6">
          <table class="govuk-table">
            <thead class="govuk-table__head">
              <tr class="govuk-table__row">
                <th scope="col" class="govuk-table__header">Name</th>
                <th scope="col" class="govuk-table__header">ULN</th>
                <th scope="col" class="govuk-table__header">Course</th>
                <th scope="col" class="govuk-table__header">Start date</th>
                <th scope="col" class="govuk-table__header govuk-table__header--numeric"></th>
              </tr>
            </thead>
            <tbody class="govuk-table__body" id="addedLearnersTableBody">
              <tr class="govuk-table__row" id="noLearnersRow">
                <td class="govuk-table__cell" colspan="5">No learners added yet.</td>
              </tr>
            </tbody>
          </table>

          <div class="govuk-button-group govuk-!-margin-top-0">
            <button class="govuk-button" data-module="govuk-button" type="submit">
              Save and continue
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>


  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <form action="#" method="post" id="mainForm">
        <div class="govuk-form-group">
          <label class="govuk-label" for="searchTerm">Search learner name or ULN</label>
          <div id="ILR-container"></div>
        </div>
      </form>
    </div>
  </div>

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <div style="background-color: #F4F2F0; padding: 15px; border: 0px solid #d3d3d3;">
        <form method="get" action="#" id="filterForm">
          <h2 class="govuk-heading-m">Filter</h2>
          <div class="govuk-grid-row">
            <div class="govuk-grid-column-one-third">
              <div class="govuk-form-group">
                <label class="govuk-label" for="courseTypeSelect">Learning type</label>
                <select class="govuk-select govuk-!-width-full" id="courseTypeSelect" name="courseType">
                  <option value="">All</option>
                  <option>Apprenticeship</option>
                  <option>Bootcamp</option>
                  <option>Short course</option>
                </select>
              </div>

              <div class="govuk-form-group">
                <label class="govuk-label" for="courseNameSelect">Course name</label>
                <select class="govuk-select govuk-!-width-full" id="courseNameSelect" name="courseName">
                  <option value="">All</option>
                  <option>Business administrator, Level 3</option>
                  <option>Customer service practitioner, Level 2</option>
                  <option>Early years practitioner, Level 2</option>
                  <option>Early years educator, Level 3</option>
                  <option>HR support, Level 3</option>
                  <option>Teaching assistant, Level 3</option>
                </select>
              </div>
            </div>

            <div class="govuk-grid-column-one-third">
              <div class="govuk-form-group">
                <label class="govuk-label" for="startMonthSelect">Start month</label>
                <select class="govuk-select govuk-!-width-full" id="startMonthSelect" name="startMonth">
                  <option value="">All</option>
                  <option>September</option>
                  <option>October</option>
                  <option>November</option>
                </select>
              </div>

              <div class="govuk-form-group">
                <label class="govuk-label" for="startYearSelect">Start year</label>
                <select class="govuk-select govuk-!-width-full" id="startYearSelect" name="startYear">
                  <option value="2025" selected>2025</option>
                  <option value="2026">2026</option>
                </select>
              </div>
            </div>

            <div class="govuk-grid-column-one-third">
              <div class="govuk-form-group">
                <label class="govuk-label">Show learners linked to</label>
                <span class="govuk-hint">Select all that apply</span>

                <div class="govuk-checkboxes govuk-checkboxes--small">
                  <div class="govuk-checkboxes__item">
                    <input class="govuk-checkboxes__input" id="employerBambinos" name="employers" type="checkbox"
                      value="BAMBINOS DAY NURSERY">
                    <label class="govuk-label govuk-checkboxes__label" for="employerBambinos">
                      BAMBINOS DAY NURSERY
                    </label>
                  </div>
                  <div class="govuk-checkboxes__item">
                    <input class="govuk-checkboxes__input" id="employerNone" name="employers" type="checkbox"
                      value="No employer">
                    <label class="govuk-label govuk-checkboxes__label" for="employerNone">
                      No employer
                    </label>
                  </div>
                  <div class="govuk-form-group govuk-!-margin-top-0">
                    <a href="/training-provider/v9/approvals/add/select-employer" id="changeEmployerLink"
                      class="govuk-link govuk-body">
                      Change employer
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div>
            <button class="govuk-button govuk-!-margin-top-1" id="applyFiltersButton" type="submit">
              Apply filters
            </button>
            <a href="javascript:void(0)" class="govuk-link govuk-!-margin-left- govuk-!-font-size-19"
              style="padding: 12px 12px; display: inline-block;" id="clearFiltersLink">
              Clear search and filters
            </a>
          </div>


        </form>
      </div>
    </div>
  </div>

  <div class="govuk-grid-row govuk-!-padding-top-6">
    <div class="govuk-grid-column-full">
      <div class="govuk-grid-row">
        <div class="govuk-grid-column-one-half">
          <p class="govuk-body record-count"></p>
        </div>
        <div class="govuk-grid-column-one-half govuk-!-text-align-right">
          <p class="govuk-body last-updated">List updated: 11:14am on 8 Oct 2025</p>
        </div>
      </div>
    </div>
  </div>

  <div class="govuk-!-margin-bottom-3">
    <a href="javascript:void(0)" id="addAllFilteredLink" class="govuk-link govuk-body">
      Add all filtered learners (<span id="filteredCount">73</span>)
    </a>
  </div>




  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <div id="resultsTableContainer">
        <table class="govuk-table">
          <thead class="govuk-table__head">
            <tr class="govuk-table__row">
              <th scope="col" class="govuk-table__header">Name</th>
              <th scope="col" class="govuk-table__header">ULN</th>
              <th scope="col" class="govuk-table__header">Course</th>
              <th scope="col" class="govuk-table__header">Start date</th>
              <th scope="col" class="govuk-table__header govuk-table__header--numeric"></th>
            </tr>
          </thead>
          <tbody class="govuk-table__body" id="recordsTableBody">
          </tbody>
        </table>


        <div class="govuk-grid-row govuk-!-margin-top-4" style="align-items: center;">
          <div class="govuk-grid-column-two-thirds">
            <nav class="govuk-pagination" aria-label="Pagination">
              <ul class="govuk-pagination__list" id="paginationList">
              </ul>
              <div class="govuk-pagination__next">
                <a class="govuk-link govuk-pagination__link" href="#" rel="next" id="nextPageLink">
                  <span class="govuk-pagination__link-title">
                    Next<span class="govuk-visually-hidden"> page</span>
                  </span>
                  <svg class="govuk-pagination__icon govuk-pagination__icon--next" xmlns="http://www.w3.org/2000/svg"
                    height="13" width="15" aria-hidden="true" focusable="false" viewBox="0 0 15 13">
                    <path
                      d="m8.107-0.0078125-1.4136 1.414 4.2926 4.293h-12.986v2h12.896l-4.1855 3.9766 1.377 1.4492 6.7441-6.4062-6.7246-6.7266z">
                    </path>
                  </svg>
                </a>
              </div>
            </nav>
          </div>

          <div class="govuk-grid-column-one-third" style="text-align: right;">
            <p class="govuk-body govuk-!-margin-bottom-0" id="resultsSummary">
            </p>
          </div>
        </div>
      </div>
      <div id="noResultsMessage" style="display: none;">
        <h2 class="govuk-heading-s">There are no matching results.</h2>
        <p class="govuk-body">It can take up to 15 minutes for ILR updates to appear here.</p>
        <p class="govuk-body">Try:</p>
        <ul class="govuk-list govuk-list--bullet">
          <li>checking the details you entered, such as ULN or name</li>
          <li>changing or removing any filters</li>
          <li>searching again after 15 minutes if you recently updated your ILR</li>
        </ul>
      </div>
    </div>
  </div>


  <script>
    // Full dataset of 73 records
    const learnersDataInitial = [{
      name: "Alan Lightfoot",
      uln: "7232486935",
      course: "Early years practitioner, Level 2",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Bernard McKelly",
      uln: "7232487018",
      course: "Early years educator, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Carla Mendoza",
      uln: "7447194694",
      course: "Early years educator, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Deepika Sharma",
      uln: "7342365215",
      course: "Early years practitioner, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Elijah Robinson",
      uln: "7582483570",
      course: "Early years practitioner, Level 2",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Fatima Hussain",
      uln: "7443068554",
      course: "Early years practitioner, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Grace OâConnor",
      uln: "7436562065",
      course: "Teaching assistant, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Mohammed Ali",
      uln: "7502286029",
      course: "Teaching assistant, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Sophia Williams",
      uln: "7418298617",
      course: "Early years practitioner, Level 2",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Yusuf Ahmed",
      uln: "7007543626",
      course: "Early years practitioner, Level 2",
      employer: "No employer"
    }, {
      name: "Emily Carter",
      uln: "8237461839",
      course: "Business administrator, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Thomas Reed",
      uln: "9128746235",
      course: "Early years educator, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Sophie Turner",
      uln: "8756341902",
      course: "HR support, Level 3",
      employer: "No employer"
    }, {
      name: "Liam Johnson",
      uln: "7348592034",
      course: "Customer service practitioner, Level 2",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Olivia Harris",
      uln: "6758219364",
      course: "Teaching assistant, Level 3",
      employer: "No employer"
    }, {
      name: "Jacob Knight",
      uln: "8392047612",
      course: "Team leader supervisor, Level 3",
      employer: "No employer"
    }, {
      name: "Isla Mason",
      uln: "9501726483",
      course: "HR support, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Noah Davies",
      uln: "7392041837",
      course: "Business administrator, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Grace Patel",
      uln: "8492037648",
      course: "Early years educator, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Harvey Bell",
      uln: "9301847562",
      course: "Teaching assistant, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Zara Collins",
      uln: "7819204736",
      course: "HR support, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Oscar Bennett",
      uln: "8021934756",
      course: "Customer service practitioner, Level 2",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Ella James",
      uln: "7182049567",
      course: "Business administrator, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Lucas Gray",
      uln: "8937162840",
      course: "Team leader supervisor, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Amelia White",
      uln: "8882049567",
      course: "Business administrator, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Leo Miller",
      uln: "9117162840",
      course: "Customer service practitioner, Level 2",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Zoe Hall",
      uln: "9021934756",
      course: "Early years educator, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "David Kim",
      uln: "8937162840",
      course: "Teaching assistant, Level 3",
      employer: "No employer"
    }, {
      name: "Nora Chen",
      uln: "8002049567",
      course: "HR support, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Felix Lee",
      uln: "9117162840",
      course: "Team leader supervisor, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Chloe Evans",
      uln: "9221934756",
      course: "Early years practitioner, Level 2",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Mia King",
      uln: "8737162840",
      course: "Business administrator, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Alex Turner",
      uln: "8552049567",
      course: "Customer service practitioner, Level 2",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Sam White",
      uln: "8667162840",
      course: "Early years educator, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Ryan Clark",
      uln: "8972049567",
      course: "Teaching assistant, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Eva Lewis",
      uln: "9287162840",
      course: "HR support, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Ben Wright",
      uln: "9492049567",
      course: "Team leader supervisor, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Lily Green",
      uln: "9507162840",
      course: "Early years practitioner, Level 2",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Jack Hill",
      uln: "9612049567",
      course: "Business administrator, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Mia Scott",
      uln: "9727162840",
      course: "Customer service practitioner, Level 2",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Noah Adams",
      uln: "9832049567",
      course: "Early years educator, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Chloe Baker",
      uln: "9947162840",
      course: "Teaching assistant, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Leo Cook",
      uln: "1052049567",
      course: "HR support, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Grace Gray",
      uln: "1167162840",
      course: "Team leader supervisor, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Oscar Hall",
      uln: "1272049567",
      course: "Early years practitioner, Level 2",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Ella Jones",
      uln: "1387162840",
      course: "Business administrator, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Ben King",
      uln: "1492049567",
      course: "Customer service practitioner, Level 2",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Lily Lee",
      uln: "1507162840",
      course: "Early years educator, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Jack Martin",
      uln: "1612049567",
      course: "Teaching assistant, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Mia Nash",
      uln: "1727162840",
      course: "HR support, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Noah Perry",
      uln: "1832049567",
      course: "Team leader supervisor, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Chloe Quinn",
      uln: "1947162840",
      course: "Early years practitioner, Level 2",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Leo Reed",
      uln: "2052049567",
      course: "Business administrator, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Grace Scott",
      uln: "2167162840",
      course: "Customer service practitioner, Level 2",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Oscar Thompson",
      uln: "2272049567",
      course: "Early years educator, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Ella Turner",
      uln: "2387162840",
      course: "Teaching assistant, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Ben White",
      uln: "2492049567",
      course: "HR support, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Lily Wilson",
      uln: "2507162840",
      course: "Team leader supervisor, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Jack Young",
      uln: "2612049567",
      course: "Early years practitioner, Level 2",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Mia Adams",
      uln: "2727162840",
      course: "Business administrator, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Noah Baker",
      uln: "2832049567",
      course: "Customer service practitioner, Level 2",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Chloe Cook",
      uln: "2947162840",
      course: "Early years educator, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Leo Davies",
      uln: "3052049567",
      course: "Teaching assistant, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Grace Evans",
      uln: "3167162840",
      course: "HR support, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Oscar Fisher",
      uln: "3272049567",
      course: "Team leader supervisor, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Ella Green",
      uln: "3387162840",
      course: "Early years practitioner, Level 2",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Ben Hall",
      uln: "3492049567",
      course: "Business administrator, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Lily Jones",
      uln: "3507162840",
      course: "Customer service practitioner, Level 2",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Jack King",
      uln: "3612049567",
      course: "Early years educator, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Mia Lee",
      uln: "3727162840",
      course: "Teaching assistant, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Noah Martin",
      uln: "3832049567",
      course: "HR support, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Chloe Nash",
      uln: "3947162840",
      course: "Team leader supervisor, Level 3",
      employer: "BAMBINOS DAY NURSERY"
    }, {
      name: "Leo Perry",
      uln: "4052049567",
      course: "Early years practitioner, Level 2",
      employer: "BAMBINOS DAY NURSERY"
    }];

    // Function to assign a random date in September, October, or November 2025 (month and year only)
    function assignRandomStartDate() {
      const months = ["September", "October", "November"];
      const month = months[Math.floor(Math.random() * months.length)];
      return `${month} 2025`;
    }

    // Assign a random start date to each learner
    learnersDataInitial.forEach(learner => {
      learner.startDate = assignRandomStartDate();
    });

    // Manually override the start dates for the specified learners
    learnersDataInitial[0].startDate = "September 2025"; // Alan Lightfoot
    learnersDataInitial[1].startDate = "September 2025"; // Bernard McKelly
    learnersDataInitial[2].startDate = "September 2025"; // Carla Mendoza

    // Sort learners alphabetically
    learnersDataInitial.sort((a, b) => a.name.localeCompare(b.name));

    // Data for the accessible autocomplete search box
    const ILR = learnersDataInitial.map(l => `${l.name} ${l.uln}`);

    // State variables for the two tables
    let learnersData = [...learnersDataInitial]; // Main list (all learners not in cohort)
    let addedLearnersData = []; // Learners in the cohort
    let filteredLearners = [...learnersData]; // The list currently being displayed in the main table

    // State variables for pagination
    let currentPage = 1;
    const pageSize = 25;

    // Initialize the accessible autocomplete
    accessibleAutocomplete({
      autoselect: true,
      element: document.querySelector('#ILR-container'),
      id: 'searchTerm', // matches the label
      name: 'ILR-autocomplete',
      source: ILR,
      defaultValue: '',
      displayMenu: 'overlay',
      minLength: 2,
      tNoResults: function () {
        return "Other";
      },
      onConfirm: function (selected) {
        // When user selects a value or presses enter
        document.querySelector('#searchTerm').value = selected || '';
        currentPage = 1; // Reset to page 1
        updateAllTables();
      }
    });


    // --- Dynamic Table and Pagination Logic ---
    document.addEventListener("DOMContentLoaded", () => {
      const filterForm = document.getElementById("filterForm");
      const searchTermInput = document.getElementById("searchTerm");
      const recordsTableBody = document.getElementById("recordsTableBody");
      const addedLearnersTableBody = document.getElementById("addedLearnersTableBody");
      const recordCountDisplay = document.querySelector(".record-count");
      const addedLearnersCount = document.getElementById("addedLearnersCount");
      const resultsSummary = document.getElementById("resultsSummary");
      const paginationList = document.getElementById("paginationList");
      const nextPageLink = document.getElementById("nextPageLink");
      const resultsTableContainer = document.getElementById("resultsTableContainer");
      const noResultsMessage = document.getElementById("noResultsMessage");
      const clearFiltersLink = document.getElementById('clearFiltersLink');
      const addAllFilteredLink = document.getElementById('addAllFilteredLink');
      const filteredCountDisplay = document.getElementById('filteredCount');
      const saveButtonDiv = document.querySelector("#addedLearnersForm .govuk-button-group");
      // This is now present in the HTML and can be referenced
      const removeAllLearnersLink = document.getElementById('removeAllLearnersLink');

      // --- Filter Functions ---

      function getActiveFilters() {
        const filters = {
          searchTerm: searchTermInput.value.trim().toLowerCase(),
          courseType: document.getElementById('courseTypeSelect').value,
          courseName: document.getElementById('courseNameSelect').value,
          startMonth: document.getElementById('startMonthSelect').value,
          startYear: document.getElementById('startYearSelect').value,
          employers: []
        };

        document.querySelectorAll("input[name='employers']:checked").forEach(cb => {
          filters.employers.push(cb.value);
        });

        return filters;
      }

      function filterLearners() {
        const filters = getActiveFilters();
        let results = [...learnersData];

        if (filters.searchTerm) {
          results = results.filter(learner =>
            learner.name.toLowerCase().includes(filters.searchTerm) ||
            learner.uln.includes(filters.searchTerm)
          );
        }

        if (filters.courseName) {
          results = results.filter(learner => learner.course === filters.courseName);
        }

        const isFilteredByYear = filters.startYear !== '2025';
        if (isFilteredByYear) {
          results = []; // All mock data is 2025, so any other year results in 0
        } else if (filters.startMonth) {
          results = results.filter(learner => learner.startDate.includes(filters.startMonth));
        }

        if (filters.employers.length > 0) {
          results = results.filter(learner => filters.employers.includes(learner.employer));
        }

        results.sort((a, b) => a.name.localeCompare(b.name));
        return results;
      }

      // --- Pagination and Rendering Functions ---

      function renderPagination() {
        paginationList.innerHTML = '';
        const totalPages = Math.ceil(filteredLearners.length / pageSize);
        const startPage = Math.max(1, currentPage - 2);
        const endPage = Math.min(totalPages, currentPage + 2);

        // Previous link
        if (currentPage > 1) {
          paginationList.innerHTML += `
              <li class="govuk-pagination__item govuk-pagination__item--prev">
                <a class="govuk-link govuk-pagination__link" href="#" data-page="${currentPage - 1}" rel="prev">
                  <svg class="govuk-pagination__icon govuk-pagination__icon--prev" xmlns="http://www.w3.org/2000/svg" height="13" width="15" aria-hidden="true" focusable="false" viewBox="0 0 15 13">
                    <path d="m6.5938-0.0078125-6.7266 6.7266 6.7441 6.4062 1.377-1.4492-4.1856-3.9766h12.896v-2h-12.986l4.2926-4.293-1.4136-1.414z"></path>
                  </svg>
                  <span class="govuk-pagination__link-title">Previous<span class="govuk-visually-hidden"> page</span></span>
                </a>
              </li>
            `;
        }

        // Page links
        for (let i = startPage; i <= endPage; i++) {
          const activeClass = i === currentPage ? ' govuk-pagination__item--current' : '';
          paginationList.innerHTML += `
              <li class="govuk-pagination__item${activeClass}">
                <a class="govuk-link govuk-pagination__link" href="#" data-page="${i}" ${i === currentPage ? 'aria-current="page"' : ''}>${i}</a>
              </li>
            `;
        }

        // Next link
        if (currentPage >= totalPages) {
          nextPageLink.classList.add('govuk-visually-hidden');
        } else {
          nextPageLink.classList.remove('govuk-visually-hidden');
          nextPageLink.querySelector('a').dataset.page = currentPage + 1;
        }
      }

      function renderTable(dataToRender, targetBody, isAddedTable = false) {
        targetBody.innerHTML = '';

        // Render actual data rows
        dataToRender.forEach(learner => {
          const row = document.createElement('tr');
          row.className = 'govuk-table__row';
          row.dataset.uln = learner.uln;
          const actionText = isAddedTable ? 'Remove' : 'Add';
          row.innerHTML = `
              <td class="govuk-table__cell">${learner.name}</td>
              <td class="govuk-table__cell">${learner.uln}</td>
              <td class="govuk-table__cell">${learner.course}</td>
              <td class="govuk-table__cell">${learner.startDate}</td>
              <td class="govuk-table__cell govuk-table__cell--numeric">
                <a href="#" class="govuk-link" data-uln="${learner.uln}" data-action="${actionText.toLowerCase()}">${actionText}</a>
              </td>
            `;
          targetBody.appendChild(row);
        });

        // *** FIX: Show "No learners added yet" row only when the added table is empty ***
        if (isAddedTable && dataToRender.length === 0) {
          targetBody.innerHTML = `
                <tr class="govuk-table__row" id="noLearnersRow">
                    <td class="govuk-table__cell" colspan="5">No learners added yet.</td>
                </tr>
            `;
        }
        // *** END FIX ***

        // Toggle visibility based on results for the main table
        if (!isAddedTable) {
          if (dataToRender.length === 0 && filteredLearners.length === 0) {
            resultsTableContainer.style.display = 'none';
            noResultsMessage.style.display = 'block';
          } else {
            resultsTableContainer.style.display = 'block';
            noResultsMessage.style.display = 'none';
          }
        }
      }

      function updateResultsSummary(totalCount) {
        const start = (currentPage - 1) * pageSize + 1;
        const end = Math.min(currentPage * pageSize, totalCount);

        if (totalCount === 0) {
          resultsSummary.textContent = '';
        } else if (totalCount <= pageSize) {
          resultsSummary.textContent = `Showing all ${totalCount} results`;
        } else {
          resultsSummary.textContent = `Showing ${start} to ${end} of ${totalCount} results`;
        }
      }

      function updateLearnerCounts(totalCount) {
        addedLearnersCount.textContent = addedLearnersData.length;
        filteredCountDisplay.textContent = totalCount;

        const year = document.getElementById('startYearSelect').value;
        const month = document.getElementById('startMonthSelect').value;
        const dateString = month ? `${month} ${year}` : year;

        if (totalCount === 1) {
          recordCountDisplay.textContent = `1 learner record matching ${dateString}`;
        } else if (totalCount > 1) {
          recordCountDisplay.textContent = `${totalCount} learner records matching ${dateString}`;
        } else {
          recordCountDisplay.textContent = ``;
        }

        // *** FIX: Correctly control visibility of the Save button and Remove All link ***
        if (addedLearnersData.length > 0) {
          saveButtonDiv.style.display = 'block';
          removeAllLearnersLink.style.display = 'inline-block';
        } else {
          saveButtonDiv.style.display = 'none';
          removeAllLearnersLink.style.display = 'none';
        }
        // *** END FIX ***
      }


      // --- Main Orchestration Function ---

      function updateAllTables() {
        filteredLearners = filterLearners();
        const totalCount = filteredLearners.length;

        const startIndex = (currentPage - 1) * pageSize;
        const paginatedData = filteredLearners.slice(startIndex, startIndex + pageSize);

        renderTable(addedLearnersData, addedLearnersTableBody, true); // Added learners
        renderTable(paginatedData, recordsTableBody, false); // Main results

        updateLearnerCounts(totalCount);
        updateResultsSummary(totalCount);
        renderPagination();
      }

      // --- Event Listeners ---

      filterForm.addEventListener('submit', (e) => {
        e.preventDefault();
        currentPage = 1;
        updateAllTables();
      });

      clearFiltersLink.addEventListener('click', (e) => {
        e.preventDefault();

        // Reset filters
        document.getElementById('courseTypeSelect').value = '';
        document.getElementById('courseNameSelect').value = '';
        document.getElementById('startMonthSelect').value = '';
        document.getElementById('startYearSelect').value = '2025';
        document.querySelectorAll("input[name='employers']").forEach(cb => cb.checked = false);
        searchTermInput.value = '';

        currentPage = 1;
        updateAllTables();
      });

      // Add/Remove learner from tables
      document.addEventListener('click', (e) => {
        if (e.target.tagName === 'A' && e.target.dataset.uln && ['add', 'remove'].includes(e.target.dataset.action)) {
          e.preventDefault();

          const uln = e.target.dataset.uln;
          const action = e.target.dataset.action;

          if (action === 'add') {
            const learnerIndex = learnersData.findIndex(l => l.uln === uln);
            if (learnerIndex !== -1) {
              const learner = learnersData.splice(learnerIndex, 1)[0];
              addedLearnersData.push(learner);
            }
          } else if (action === 'remove') {
            const learnerIndex = addedLearnersData.findIndex(l => l.uln === uln);
            if (learnerIndex !== -1) {
              const learner = addedLearnersData.splice(learnerIndex, 1)[0];
              learnersData.push(learner);
              learnersData.sort((a, b) => a.name.localeCompare(b.name));
            }
          }

          currentPage = 1;
          updateAllTables();
        }
      });

      // Pagination Click
      document.addEventListener('click', (e) => {
        if (e.target.closest('.govuk-pagination__link') && e.target.closest('.govuk-pagination__link').dataset.page) {
          e.preventDefault();
          const targetPage = parseInt(e.target.closest('.govuk-pagination__link').dataset.page);
          if (targetPage > 0 && targetPage <= Math.ceil(filteredLearners.length / pageSize)) {
            currentPage = targetPage;
            updateAllTables();
          }
        }
      });

      // 'Remove all learners' Link Handler
      removeAllLearnersLink.addEventListener('click', (e) => {
        e.preventDefault();

        if (addedLearnersData.length === 0) return;

        addedLearnersData.forEach(learnerToRemove => {
          learnersData.push(learnerToRemove);
        });

        addedLearnersData = [];
        learnersData.sort((a, b) => a.name.localeCompare(b.name));

        currentPage = 1;
        updateAllTables();

        window.scrollTo(0, 0);
      });

      // 'Add all filtered learners' Link Handler
      addAllFilteredLink.addEventListener('click', (e) => {
        e.preventDefault();

        if (filteredLearners.length === 0) return;

        filteredLearners.forEach(learnerToAdd => {
          const index = learnersData.findIndex(l => l.uln === learnerToAdd.uln);
          if (index !== -1) {
            const learner = learnersData.splice(index, 1)[0];
            addedLearnersData.push(learner);
          }
        });

        addedLearnersData.sort((a, b) => a.name.localeCompare(b.name));

        currentPage = 1;
        updateAllTables();

        window.scrollTo(0, 0);
      });

      // Initial call to populate the tables on load
      updateAllTables();
    });
  </script>

  {% endblock %}